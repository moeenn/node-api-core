datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URI")
}

generator client {
  provider = "prisma-client-js"
}

enum UserRole {
  ADMIN
  USER
}

model Password {
  hash   String
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id        String         @id @default(uuid())
  email     String         @unique
  name      String
  phone     String?
  staffId   String
  password  Password?
  approved  Boolean        @default(true)
  role      UserRole       @default(USER)
  locations UserLocation[]
}

model AllowedUserEmailDomain {
  id     String @id @default(uuid())
  domain String @unique
}

enum LocationType {
  REGION
  BRANCH
  OFFICE
}

model Location {
  id             String         @id @default(uuid())
  code           String         @unique
  description    String
  address        String
  contact        String
  lat            Float
  lng            Float
  hierarchyId    String         @unique
  locationType   LocationType   @default(OFFICE)
  users          UserLocation[]
}

enum LocationAccessType {
  READONLY
  WRITE
}

model UserLocation {
  user               User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  location           Location           @relation(fields: [locationId], references: [id], onDelete: Cascade)
  userId             String
  locationId         String
  locationAccessType LocationAccessType @default(READONLY)

  @@id([userId, locationId])
}